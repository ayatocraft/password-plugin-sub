
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>Password Lock Parent</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 20px;
  }

  input, button {
    padding: 8px;
    margin: 4px 0;
  }

  /* ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¡¨ç¤ºç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
  .overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.5);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 1000;
  }

  .overlay.show {
    display: flex;
  }

  iframe {
    width: 360px;
    height: 240px;
    border: none;
  }
</style>
</head>
<body>

<h2>è¦ªHTMLï¼ˆç®¡ç†ç”»é¢ï¼‰</h2>

<input id="pwInput" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¨­å®š">
<br>
<button onclick="savePassword()">ä¿å­˜</button>
<button onclick="clearPassword()">å‰Šé™¤</button>

<hr>

<button onclick="openLock()">ğŸ”’ ãƒ­ãƒƒã‚¯ã‚’è¡¨ç¤º</button>

<!-- ãƒ—ãƒ©ã‚°ã‚¤ãƒ³è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
<div class="overlay" id="overlay">
  <iframe
    id="passwordPlugin"
    src="https://ayatocraft.github.io/passwordplugin/password-widget.html">
  </iframe>
</div>

<script>
  const overlay = document.getElementById("overlay");
  const iframe  = document.getElementById("passwordPlugin");

  const PLUGIN_ORIGIN = "https://ayatocraft.github.io";
  const STORAGE_KEY  = "password-lock-value";

  // èµ·å‹•æ™‚ï¼šä¿å­˜æ¸ˆã¿ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¾©å…ƒ
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) pwInput.value = saved;

  function savePassword() {
    const pw = pwInput.value;
    localStorage.setItem(STORAGE_KEY, pw);
    sendPassword(pw);
  }

  function clearPassword() {
    localStorage.removeItem(STORAGE_KEY);
    pwInput.value = "";
  }

  function openLock() {
    overlay.classList.add("show");

    // iframeãŒæ—¢ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹å ´åˆã«ã‚‚é€ã‚‹
    const pw = localStorage.getItem(STORAGE_KEY);
    if (pw) sendPassword(pw);
  }

  function closeLock() {
    overlay.classList.remove("show");
  }

  function sendPassword(pw) {
    iframe.contentWindow.postMessage(
      { type: "init", password: pw },
      PLUGIN_ORIGIN
    );
  }

  // iframeãƒ­ãƒ¼ãƒ‰æ™‚ï¼ˆåˆå›å¯¾ç­–ï¼‰
  iframe.addEventListener("load", () => {
    const pw = localStorage.getItem(STORAGE_KEY);
    if (pw) sendPassword(pw);
  });

  // ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‹ã‚‰ã®é€šçŸ¥
  window.addEventListener("message", e => {
    if (e.origin !== PLUGIN_ORIGIN) return;

    if (e.data?.type === "password-success") {
      closeLock();     // è¦ªå´ã§éš ã™
      alert("ãƒ­ãƒƒã‚¯è§£é™¤");
    }

    if (e.data?.type === "password-cancel") {
      closeLock();     // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ã‚‚é–‰ã˜ã‚‹
    }
  });
</script>

</body>
</html>
